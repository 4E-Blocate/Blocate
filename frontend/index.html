<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Guardian DePIN</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ¥ Patient Guardian DePIN</h1>
      <p class="subtitle">Decentralized Patient Monitoring System</p>
    </header>

    <!-- Live Sensor Data -->
    <section class="card sensor-display">
      <h2>ğŸ“Š Live Sensor Data</h2>
      <div class="sensor-status">
        <div class="status-badge" id="sensorStatus">
          <span class="status-dot"></span>
          <span>Waiting for data...</span>
        </div>
      </div>
      
      <div class="sensor-grid">
        <div class="sensor-card">
          <div class="sensor-icon">â¤ï¸</div>
          <div class="sensor-label">Heart Rate</div>
          <div class="sensor-value" id="bpmValue">--</div>
          <div class="sensor-unit">BPM</div>
        </div>
        
        <div class="sensor-card">
          <div class="sensor-icon">ğŸŒ¡ï¸</div>
          <div class="sensor-label">Temperature</div>
          <div class="sensor-value" id="tempValue">--</div>
          <div class="sensor-unit">Â°C</div>
        </div>
        
        <div class="sensor-card">
          <div class="sensor-icon">ğŸ“</div>
          <div class="sensor-label">Location</div>
          <div class="sensor-value small" id="gpsValue">--</div>
          <div class="sensor-unit">GPS</div>
        </div>
        
        <div class="sensor-card">
          <div class="sensor-icon">ğŸ·ï¸</div>
          <div class="sensor-label">Device ID</div>
          <div class="sensor-value small" id="deviceValue">--</div>
          <div class="sensor-unit">ID</div>
        </div>
      </div>
      
      <div class="event-alert" id="eventAlert" style="display: none;">
        <div class="alert-icon">âš ï¸</div>
        <div class="alert-text"></div>
      </div>
      
      <div class="last-update">
        Last update: <span id="lastUpdate">Never</span>
      </div>
    </section>

    <!-- Wallet Connection -->
    <section class="wallet-section">
      <div id="walletStatus" class="disconnected">
        <span class="status-icon">âŒ</span>
        <span class="status-text">Wallet Not Connected</span>
      </div>
      <button id="connectBtn" class="btn btn-primary">Connect MetaMask</button>
      <button id="disconnectBtn" class="btn btn-secondary" style="display: none;">Disconnect</button>
    </section>

    <!-- Register Device -->
    <section class="card">
      <h2>ğŸ“± Register New Device</h2>
      <form id="registerForm">
        <div class="form-group">
          <label>Device ID</label>
          <input type="text" id="deviceId" placeholder="e.g., patient-001" required>
        </div>
        <div class="form-group">
          <label>Patient Name</label>
          <input type="text" id="patientName" placeholder="e.g., John Doe" required>
        </div>
        <div class="form-group">
          <label>Age</label>
          <input type="number" id="age" placeholder="e.g., 65" min="1" max="150" required>
        </div>
        <div class="form-group">
          <label>Guardian Wallet Address</label>
          <input type="text" id="guardianAddress" placeholder="0x... (leave empty to use your wallet)">
          <small>ğŸ”’ Guardian can log events and change settings. Leave empty to be your own guardian, or enter another wallet address (e.g., family member, doctor) to assign them as guardian.</small>
        </div>
        <div class="form-group">
          <label>Home Location (GPS)</label>
          <input type="text" id="homeGPS" placeholder="e.g., 14.5995,120.9842" required>
          <small>Format: latitude,longitude</small>
        </div>
        <button type="submit" class="btn btn-success">Register Device</button>
      </form>
    </section>

    <!-- View Device & Events -->
    <section class="card">
      <h2>ğŸ” View Device Information</h2>
      <div class="form-group">
        <label>Device ID</label>
        <input type="text" id="queryDeviceId" placeholder="e.g., patient-001">
      </div>
      <button id="getDeviceBtn" class="btn btn-primary">Get Device Info</button>
      <button id="getEventsBtn" class="btn btn-secondary">Get Events</button>
      
      <div id="deviceInfo" class="result-box"></div>
      <div id="eventsOutput" class="result-box"></div>
    </section>

    <!-- Multi-Device Queries -->
    <section class="card">
      <h2>ğŸ‘¥ My Devices & Patients</h2>
      
      <div class="button-group">
        <button id="getMyDevicesBtn" class="btn btn-primary">My Registered Devices</button>
        <button id="getMyPatientsBtn" class="btn btn-success">Patients I'm Guarding</button>
      </div>
      
      <div id="multiDeviceOutput" class="result-box"></div>
    </section>

    <!-- Contract Info -->
    <section class="card contract-info">
      <h3>ğŸ“„ Contract Information</h3>
      <div class="info-row">
        <strong>Network:</strong> <span id="networkName">-</span>
      </div>
      <div class="info-row">
        <strong>Contract Address:</strong> 
        <code id="contractAddress">Loading...</code>
      </div>
    </section>

    <footer>
      <p>Built with â¤ï¸ for decentralized healthcare</p>
    </footer>
  </div>

  <script type="module" src="/main.js"></script>
</body>
</html>
